---
// Giscus comment system (GitHub Discussions based)
// Configure at https://giscus.app/
---

<section class="mx-auto px-6 sm:px-6 max-w-3xl mt-12 mb-8">
  <h3 class="text-xl font-bold font-heading mb-4 dark:text-slate-300">Comments</h3>
  <div id="giscus-container">
    <script
      is:inline
      src="https://giscus.app/client.js"
      data-repo="james20141606/cmwonderland.com"
      data-repo-id=""
      data-category="Announcements"
      data-category-id=""
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="top"
      data-theme="preferred_color_scheme"
      data-lang="en"
      data-loading="lazy"
      crossorigin="anonymous"
      async
    ></script>
  </div>
</section>

<script is:inline>
(function() {
  function syncGiscusTheme() {
    var iframe = document.querySelector('iframe.giscus-frame');
    if (!iframe) return;
    var isDark = document.documentElement.classList.contains('dark');
    var theme = isDark ? 'dark' : 'light';
    iframe.contentWindow.postMessage(
      { giscus: { setConfig: { theme: theme } } },
      'https://giscus.app'
    );
  }

  // Watch for theme changes
  var observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(m) {
      if (m.attributeName === 'class') {
        syncGiscusTheme();
      }
    });
  });

  function initGiscusObserver() {
    observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGiscusObserver);
  } else {
    initGiscusObserver();
  }
  document.addEventListener('astro:page-load', initGiscusObserver);
})();
</script>
